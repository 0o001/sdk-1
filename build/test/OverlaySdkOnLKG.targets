<Project ToolsVersion="14.0" DefaultTargets="Test">
  <Target Name="OverlaySdkOnLKG">
    <ItemGroup>
      <OverlaySDK Include="$(DotNetCoreSdkLKGPublishDirectory)/**/*" />
      <OverlayCLI Include="$(OutputDirectory)/**/*" />
    </ItemGroup>

    <Copy SourceFiles="@(OverlaySDK)"
          DestinationFiles="@(OverlaySDK->'$(SdkOutputDirectory)\%(RecursiveDir)%(Filename)%(Extension)')" />

    <ItemGroup>
      <OldSdk Include="$(SdkOutputDirectory)/sdk/$(DotNetCoreSdkLKGVersion)/**/*" />
    </ItemGroup>

    <Move SourceFiles="@(OldSdk)"
          DestinationFiles="@(OldSdk->'$(SdkOutputDirectory)\sdk\$(SdkVersion)\%(RecursiveDir)%(Filename)%(Extension)')" />

    <RemoveDir Directories="$(SdkOutputDirectory)/sdk/$(DotNetCoreSdkLKGVersion)" />

    <Copy SourceFiles="@(OverlayCLI)"
          DestinationFiles="@(OverlayCLI->'$(SdkOutputDirectory)\%(RecursiveDir)%(Filename)%(Extension)')" />
  </Target>

  <Target Name="PublishStage2WithBackwardsCompatibleRuntimes"
          AfterTargets="OverlaySdkOnLKG;">
    <ItemGroup>
      <BackwardsCompatibleSharedFrameworks Remove="*" />
      <BackwardsCompatibleSharedFrameworks Include="$(BackwardsCompatibleSharedFrameworksPublishDirectory)/**/*" />

      <Stage2Cli Remove="*" />
      <Stage2Cli Include="$(SdkOutputDirectory)/**/*" />
    </ItemGroup>

    <Copy SourceFiles="@(BackwardsCompatibleSharedFrameworks)"
          DestinationFiles="@(BackwardsCompatibleSharedFrameworks->'$(Stage2WithBackwardsCompatibleRuntimesOutputDirectory)/%(RecursiveDir)%(Filename)%(Extension)')" />

    <Copy SourceFiles="@(Stage2Cli)"
          DestinationFiles="@(Stage2Cli->'$(Stage2WithBackwardsCompatibleRuntimesOutputDirectory)/%(RecursiveDir)%(Filename)%(Extension)')" />
  </Target>
</Project>